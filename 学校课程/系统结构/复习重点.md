# 高级计算机系统结构复习提纲

## 第一章 量化设计与分析基础

1. 计算机的分类类别
2. 计算机系统结构定义和计算机的设计任务：指令集结构概念及要素
3. 实现技术的趋势：技术发展的趋势
4. 集成电路功耗的趋势：功耗的概念
5. 可靠性：提高可靠性的方法
6. 测量、报告和总结计算机性能：计算机主要性能指标
7. 计算机设计的量化原则：Amdahl定律

**计算机的分类**

- Flynns 分类： 基于指令流 和 数据流 数量的计算机结构分类

SISD （单指令单数据）

> 单指令 ： 在任一时钟周期只有单个指令流在 CPU 上执行
> 
> 单数据 ： 在任一时钟周期只有单个数据流用作输入
> 
> 确定执行 ： 程序在给定的输入条件下多次运行， 执行流程和结果是一致的

MISD （多指令单数据）

> 每个数据流进入多个处理单元
> 
> 每个处理单元用单个指令流对数据进行独立操作

SIMD  （单指令多数据）

> 一种并行计算机： 处理数据级并行
> 
> 单指令：在任一时钟周期，所有处理单元执行相同指令
> 
> 多数据：每个处理单元能够对不同数据元素进行操作

MIMD    (多指令多数据)

> 并行计算机：线程级 或 任务级并行
> 
> 多指令： 每个处理器可以执行不同的指令流
> 
> 多数据： 每个处理器可以对不同数据流进行操作
> 
> 各个处理器执行可以是同步的或者是异步的，确定性的或者非确定性的
> 
> 比 SIMD 更灵活，适应性更强。很适合任务级并行，也可以开发数据级并行，开销比SIMD高

FLynn 分类模型是抽象和粗略的

现代的不少并行处理器是 SISD， SIMD和 MIMD 的混合类型

- 市场分类：
  
  个人移动设备，桌面计算机，服务器，集群/仓库级计算机，嵌入式计算机

**计算机系统结构的概念**

由程序员 （机器语言）看见的计算系统属性，即概念性结构和功能的行为，以区分数据流动和控制逻辑设计的组成以及物理实现

**练习**

- 主存容量与编址方式（按位，按字节，按字访问等）的确定属于计算机系统结构

- 为达到所定性能价格比，主存速度应多快，在逻辑结构上需采用什么措施，属于计算机组成

- 主存系统的物理实现，如存储器器件的选定，逻辑电路的设计，微组装技术的选定属于计算机实现 

**计算机设计的任务**

- 定义用户的需求

- 确定一台新计算机的重要属性，必须是在考虑成本，功耗，可用性等限制下使其性能最优

**实现技术的趋势**

摩尔定律

- 集成电路逻辑技术

- 半导体 DRAM

- 磁盘技术

- 网络 

**一些概念**

带宽/吞吐量 : 在给定时间完成的工作总量

时延/响应时间： 一个事件从开始到完成的时间

**经验法则**

带宽增加速度与时延平方改进速度成比例

**集成电路功耗的趋势**

功耗对芯片的规模也提出了挑战

功耗与面积成正比

单核性能与面积增加倍数的一半成正比

多核有更高的功率利用率

**可靠性，提高可靠性的方法**

可靠性：广义上包括可靠性，安全性和可用性

计算机的可靠性：用于表示系统提供给用户服务的质量

**提高可靠性的方法**

冗余：

- 时间冗余：重复操作直到没有错误

- 资源冗余：配置另外的相同部件，有错时用于替代出错部件

**计算机主要的性能指标**

定义性能：性能对不同的人意味着不同的事情，因此评价性能是很微妙的

**比较机器性能的指标**

执行时间

吞吐量：网站服务器

MIPS - millions of instructions per second

**用程序集比较机器性能**

选择适当的程序评估性能

不同的平均值

**性能指标 - 响应时间**

- 墙钟时间
  
  - 程序开始执行到结束看钟知道的时间，就是墙钟时间，也称为响应时间或者是消逝时间
  
  - 测量用户感受到的系统速度

- 墙中时间的问题
  
  - 如果一个机器上运行多个程序
  
  - 如果程序运行时需要用户输入

**性能指标 - CPU时间**

- 测量 CPU时间 更具有可计算性 （not waiting for I/O）
  
  - 测量设计者感受到的 CPU 速度

- CPU 时间进一步分为
  
  - 用户 CPU 时间 - 花费在用户模式的时间
  
  - 系统 CPU 时间 - 花费在 OS 的时间

- Unix时间命令报告 CPU 时间

**性能指标 - 吞吐量**

- 单位时间内完成的工作总量
  
  - 测量管理员感觉到的系统性能

- 常用吞吐量测量
  
  - 每天产生的代码行的数量
  
  - 每秒处理的事务数量，如每秒服务的网页数量

- 处理器性能 一半仅使用时延指标：程序A 比 程序B 快 10 倍

- 对于很多应用，吞吐量比时延更重要：金融市场，政府统计

**响应时间和吞吐量**

- 通常改善了响应时间 也会改善 吞吐量
  
  - 处理器用更快的型号替换

- 只改善吞吐量 而不改善响应时间
  
  - 在一个系统中增加额外的处理器，如多处理器

**计算机设计的量化原则**

- 利用并行性

并行性的层次 ： 

> 系统级：多线程，多个处理器
> 
> 指令级：流水线，超标量
> 
> 操作级：并行加法器，组相联cache，功能部件流水线

- 局部性原理

程序特性：趋于重用最近用过的数据和指令

时间局部性（Temporal locality） 和 空间局部性（Spatial locality）

- 注重经常性事件

计算机设计最重要和普遍原则：功耗，资源分配，性能，可靠性

经验法则：simple is fast

简化常用事件，速度能够更快。CPU中两个数相加，结果可能产生溢出，溢出情况较少，不溢出才是常见情况。因此，可以通过简化不溢出相加的操作来提高机器的性能。

- Amdahl's 定律

![](../../img/2024-12-21-11-50-52-image.png)

![](../../img/2024-12-21-11-52-34-image.png)

![](../../img/2024-12-21-11-52-49-image.png)

![](../../img/2024-12-21-14-26-01-image.png)

![](../../img/2024-12-21-14-31-43-image.png)

![](../../img/2024-12-21-14-33-52-image.png)

加速比反映了使用改进措施后完成一个 任务比不使用改进措施完成同一任务加快的比率。

要直接测量使用新改进措施的改进时间是困难的。所以使用 CPU 性能公式进行判断

- CPU 性能公式

![](../../img/2024-12-21-14-51-49-image.png)

![](../../img/2024-12-21-14-53-06-image.png)

![](../../img/2024-12-21-14-53-11-image.png)

CPI：Cycles Per Instruction,每条指令执行所花的时钟周期数。对于某一条特定的指令，其CPI是一个确定的值。对于某一个程序或一台机器，其CPI是一个平均值，表示该程序或该机器指令集中一条指令执行时平均需要多少个时钟周期。所以 CPI = CPU时钟周期数 ÷指令条数

CPU 执行时间 = CPU时钟周期数 × 时钟周期
                        = CPU时钟周期数 ÷ 时钟频率
                        = CPI ×指令条数 × 时钟周期

![](../../img/2024-12-21-15-07-40-image.png)

CPU 性能取决于3个特征：

- clock cycle (or rate)        ( CCT )

- clock cycles per instruction ( CPI )

- instruction count.            ( IC )

![](../../img/2024-12-21-15-21-26-image.png)

## 第二章 指令系统原理与实例

指令集系统结构（Instruction Set Architecture ISA），即计算机硬件对程序员和编译器开发者可见的部分

1. 指令集系统结构的分类：指令集系统的不同结构

指令集系统结构最根本的区别：在于处理器内部数据的存储结构不同

**存储结构** ： 堆栈，累加器或一组寄存器。操作数可以显式指定或者隐含指定。

- 堆栈系统结构中操作数隐含地位于栈顶

- 累加器系统结构中的一个隐含操作数就是累加器

- 通用寄存器结构系统中只能明确地指定操作数，不是寄存器就是存储器地址

![](../../img/2024-12-21-20-38-48-image.png)

按照 通用寄存器访问方式划分，有两种通用寄存器系统结构的计算机:

- register-memory 系统结构，一般指令都可以访问存储器。

- register-register 或者 load-store 系统结构，只能通过 load 和 store 指令来访问内存

教材中提到的纯 memory-menmory 系统结构，现实中不存在的结构，把所有的数据都保存在存储器中

1. 存储器寻址：大小端模式及地址对齐
2. MIPS系统结构：MIPS指令集结构

**通用寄存器出现的原因**

- 寄存器比存储器快

- 编译器使用寄存器很方便，比使用其他存储形式效率更高

- 寄存器用来存放变量，减少了数据流量，加速程序运行（寄存器比存储器快）；改善代码密度（寄存器地址比存储器地址的位数要少）

**存储器寻址**

小端模式&大端模式

小端模式把地址为“X…X000”的字节放在整个字的最低有效位置上（低地址存低字节）,字节序号为：

| 7   | 6   | 5   | 4   | 3   | 2   | 1   | 0   |
| --- | --- | --- | --- | --- | --- | --- | --- |

大端模式把地址为“X…X000”的字节放在整个字的最高有效位置上（低地址存高字节）,字节序号为：

| 0   | 1   | 2   | 3   | 4   | 5   | 6   | 7   |
| --- | --- | --- | --- | --- | --- | --- | --- |

<mark>**MIPS系统结构：MIPS指令集结构</mark>**

## 第三章 单周期MIPS处理器的设计

1. add, sub, addi, subi, lw, sw, beq, j 每条指令在单周期处理器中的执行逻辑

2. 上述指令的指令编码、代码、功能以及在单周期中的数据通路，条件分支指令的地址计算、单周期各功能部件的控制信号值判断

3. 中断和异常的处理时机

## 第四章 流水线技术及指令级并行（非常重要）

1. 流水线的概念、分类

2. 流水线的时空图及性能指标计算

3. add, sub, addi, subi, lw, sw, beq每条指令在5级流水线的执行过程

4. 结构冒险、数据冒险和控制冒险的判断，以及需要暂停的时钟周期数的判断（控制冒险的解决性能依赖于分支地址计算阶段和分支条件判断阶段）

5. 结构冒险、数据冒险和控制冒险的解决办法

6. 流水线中处理中断和异常的方法

7. 记分牌动态调度算法、Tomasulo动态调度算法

## 第五章 存储系统

1. 存储器的分类和主要特点

2. Cache的三种映像关系：全相联、直接映像、组相联

3. 主存地址Tag、Index、块内偏移三个字段的计算

4. Cache块的替换策略

5. Cache的读写过程

6. 平均访存时间和CPU时间的计算

7. Cache失效率的类别，以及每种失效率的解决方法有哪些

8. 虚拟地址到物理地址的转换过程，TLB表的原理和作用，与Cache的关系，访存时间的最好情况和最坏情况的判断
